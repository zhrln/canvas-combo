!function(t,a){"use strict";function i(){-1==this.$wrap.className.indexOf("j-unsupport-cors")&&(this.$wrap.className=this.$wrap.className.split(" ").concat("j-unsupport-cors").join(" "));for(var t,a=document.createDocumentFragment();this.imageQueue.length;)t=n(),t.src=this.imageQueue.shift(),a.appendChild(t);s(this.$wrap,a)}function e(t,a){var i=h();if(this.imageQueue=[],this.loadStatus=0,this.$wrap="string"==typeof t?document.querySelector(t):t,this._canvas=i.canvas,this._context=i.context,a&&a.images&&a.images.length&&this.add(a.images),this.$wrap.tagName&&"img"==this.$wrap.tagName.toLowerCase()){if(!l)throw new Error("浏览器不支持CORS,需要设置一个不是IMG的容器");this.contentImage=this.$wrap}else l&&(this.contentImage=n(),s(this.$wrap,this.contentImage))}function n(){var t=new Image;return t.className="j-canvas-combo",t}function s(t,a){t.appendChild(a)}function h(){var t=document.createElement("canvas"),a=t.getContext("2d");return t.width=0,t.height=0,{canvas:t,context:a}}function o(t,a){if(g[t])return void(a&&a(null,g[t]));var i=new Image;i.crossOrigin="anonymous",i.onload=function(){g[t]=this,i=null,a&&a(null,g[t])},i.onerror=function(){i=null,a&&a("err")},i.src=t}function c(){if(1!=this.loadStatus){if(0==this.imageQueue.length)return 2==this.loadStatus&&(u.call(this,r.call(this)),m.call(this),this.imgTmpCache=[]),void(this.loadStatus=0);this.loadStatus=1,this.imgTmpCache=this.imgTmpCache||[];var t=this.imageQueue.shift();o(t,function(t,a){t||(this.imgTmpCache.push(a),this.loadStatus=2,c.call(this))}.bind(this))}}function r(){this.tempCanvasObj=this.tempCanvasObj||h();var t=0,a=0,i=0,e=this.tempCanvasObj,n=this.imgTmpCache;return n.forEach(function(i){t+=i.height,a=Math.max(a,i.width)}),e.canvas.width=a,e.canvas.height=t,e.context.fillStyle="#ffffff",e.context.fillRect(0,0,a,t),n.forEach(function(t){e.context.drawImage(t,0,i),i+=t.height}),e.context.getImageData(0,0,e.canvas.width,e.canvas.height)}function u(t){var a,i=this._canvas.height;this._canvas.width&&this._canvas.height&&(a=this._context.getImageData(0,0,this._canvas.width,this._canvas.height)),this._canvas.width=Math.max(this._canvas.width,t.width),this._canvas.height+=t.height,a&&this._context.putImageData(a,0,0),this._context.putImageData(t,0,i)}function m(){this.contentImage.src=this._canvas.toDataURL("image/jpeg")}if(!a.CanvasCombo){var g={},l=function(t){return void 0!==t.crossOrigin}(new Image),p=function(t,a){l||console.warn("浏览器不支持CORS"),e.apply(this,arguments)},f=p.prototype;f.add=function(t){if("string"==typeof t)this.imageQueue.push(t);else{if(!t||"[object Array]"!==Object.prototype.toString.call(t))return 0;Array.prototype.push.apply(this.imageQueue,t)}l?c.call(this):i.call(this)},f.supportCORS=function(){return l},a.CanvasCombo=p}}(window,window.lib||(window.lib={}));